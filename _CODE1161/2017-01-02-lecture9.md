---
layout: post
title: Lecture 9&#58; Python in x, exam
date: 2017-01-13 00:00:00  PDT
type: post
published: true
status: publish
categories: []
tags: []

#this goes on the index page, and into facebook shares
description: How do we use Python in Grasshopper and Dynamo? AND the exam!

# This is what twitter will pick up if someone tweets the link to this page
# 110 marker 1234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789
twitter-body:
#Twitter and facebook will pick up this image. you can also use it in a post with:
# ![alt text]({{ site.baseurl }}/assets/{{page.featuredimg}})
featuredimg:
---

<style>
iframe {
  width: 100%;
  height: 820px;
  border: 0;
}
</style>

# The filter

![](https://media.giphy.com/media/SkQWNwFRLOKCk/giphy.gif)

This fancy thing is making a subset of points and using them as the centre point for some spheres. It's taking advantage of the cull pattern node in Grasshopper. This actually works a lot like boolean indexing in Pandas; it takes a list of booleans and masks the other list with it. E.g. given
```
pattern = [True,  True,  False,  True]
list    = [point, point, point, point]
```

it'd give you `[point, point, null, point]`, and Grasshopper only puts spheres on points, not `null`s.

This is cool'n'all, but it's a lot of nodes to achieve a simple thing. In real life we'd probably just make a cluster to handle this, but for now, let's imagine that this is actually a really logic intensive operation that would require _loads_ of nodes, and can be achieved in just a few lines of python. (You'd be surprised how often this kind of thing happens once you start looking.)

# Getting Python in Rhino

Get the python plugin [from here](http://www.food4rhino.com/app/ghpython) and install it. That's it. Now you can use it by putting a python node onto the canvas from the _math_ panel.

# Simple Python Filter

![]({{ site.baseurl }}/assets/17/empty_python.png)

If we plug some stuff into our node nothing will happen, but it'll give us something to work with.

To get into the editor, double click the python node:

![]({{ site.baseurl }}/assets/17/editor.png)

That gives us this slightly sad editor. (After the luxury of atom.) There's nothing in here to give us a clue what to do, it's scary!

Fear not, there are some magic variables already in scope. By default that's `x`, `y` and `a`. All of these are terrible variable names, but will change them in a minute.

Everything from now on will be in the editor unless I say otherwise. When I write:
```python
print y
```
then you type it into the editor and press the **test** button. It should print a number in the grey box at the bottom. It's python 2.7 so no brackets on the print. It's actually IronPython, but we'll sweep that under the carpet for now.

We can also `print x` and we'll get something that looks like this `e194b904-86a1-48ed-ad8e-75c6e8b8b364`. This is a GUID (Globally Unique IDentifier) which is cool, but a pain to work with. If we jump out of the editor and right click on `x` then we get this menu:

![]({{ site.baseurl }}/assets/17/type_hint.png)

We want to give the input a type hint so we don't need to look after the GUID ourselves. As it's getting points, let's pick `Point3d`. Now if we look in the editor it prints `0.0553423445929505,8.63313403382578,1.51597924042306` which is the x,y,z values of the point.

:blowfish: What? There's a hundred points. Why is is only showing one? This is some grasshopper magic. It's taking each one and running the python script for each element. We can use this to make our life easier. We can make the filter like this:

```python
if x.X > y:
    a = x
```
So if we plug our spheres into the `a` output it works exactly like our cull-based filter. This is nice, super terse, but single letter variables are :poop:.

If we right click on the inputs and rename them then we need to do the same in the code, but doesn't this look nicer:

![]({{ site.baseurl }}/assets/17/better_names.png)

and the code looks like this:
```python
if points_to_filter.X > x_cutoff:
    filtered_points = points_to_filter
```
Which is much more readable.

We could stop here, it works, so why do more. In most cases in the wild this _is_ where you'd stop. But if we look at the performance indicators on the bottom of the nodes, and we see that our python node is a resource hog, there are things we can do to speed it up.

Computer things happen very fast, too fast to really understand. Let's use a culinary analogy. If we're topping strawberries, the way we're doing it would be:

1. put on our chef whites
1. clean the kitchen
1. get the strawberries out of the fridge[^1]
1. get a chopping board out
2. top one strawberry
3. put it in the bowl of topped strawberries
4. put the chopping board away
5. put the strawberries away
6. change back onto normal clothes
7. goto 1

Which is a bit inefficient! We'd rather do:

1. put on our chef whites
1. clean the kitchen
1. get the strawberries out of the fridge[^1]
1. get a chopping board out
2. while there are still strawberries:
  2. top one strawberry
  3. put it in the bowl of topped strawberries
4. put the chopping board away
5. put the strawberries away
6. change back onto normal clothes

This is technically thought of as the startup cost of the node, and if it's called a lot of times with _item access_, then there's _n Ã— startup_ to do, but if we can use _list access_ then the startup and teardown is only called once.

![]({{ site.baseurl }}/assets/17/access_type.png)

Setting this option will make it break because we're now dealing with a list, but we know how to modify our code to handle it:
```python
filtered_points = []
for p in points_to_filter:
    if p.X > x_cutoff:
        filtered_points.append(p)
```
so for minimal extra work, we get a big performance improvement. For simple tasks like this where the bulk of the work is in setup and teardown it can be more than three times faster! :racehorse:


[^1]: I know that only an enemy of quality would keep their strawberries in the fridge, but it's just a metaphor.

# This week's reading :books:

**Victor, B.** [_Inventing On Principle_](http://worrydream.com/InventingOnPrinciple).
